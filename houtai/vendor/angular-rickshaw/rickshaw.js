"use strict";angular.module("angular-rickshaw",[]).directive("rickshaw",["$compile","$window",function(e,r){return{restrict:"EA",scope:{options:"=rickshawOptions",series:"=rickshawSeries",features:"=rickshawFeatures"},link:function(i,a,t){function s(){w.setSize(),w.render()}function n(e){var r=e.data,i=e.series;if(!e.series)return r;i.forEach(function(e){var i=e.key||e.name;if(!i)throw"series needs a key or a name";r.forEach(function(r){var a=r.key||r.name;if(!a)throw"data needs a key or a name";if(i==a){["color","name","data"].forEach(function(i){r[i]&&(e[i]=r[i])})}})})}function o(){w&&g&&(n({data:i.series,series:g.series}),s())}function c(){if(w){if(i.options){for(var r in i.options)g[r]=i.options[r],console.log(r+"="+i.options[r]);g.element=u[0]}w.configure(g)}else f=angular.element(a),f.append(u),f.empty(),u=e("<div></div>")(i),f.append(u),g=angular.copy(i.options),g.element=u[0],g.series=i.series,w=new Rickshaw.Graph(g);if(i.features){if(i.features.hover){var t={graph:w};t.xFormatter=i.features.hover.xFormatter,t.yFormatter=i.features.hover.yFormatter,t.formatter=i.features.hover.formatter;new Rickshaw.Graph.HoverDetail(t)}if(i.features.palette)for(var n=new Rickshaw.Color.Palette({scheme:i.features.palette}),o=0;o<g.series.length;o++)g.series[o].color=n.color()}if(s(),i.features){if(i.features.xAxis&&!m){var c={graph:w};if(i.features.xAxis.timeUnit){var k=new Rickshaw.Fixtures.Time;c.timeUnit=k.unit(i.features.xAxis.timeUnit)}i.features.xAxis.tickFormat&&(c.tickFormat=i.features.xAxis.tickFormat),i.features.xAxis.ticksTreatment&&(c.ticksTreatment=i.features.xAxis.ticksTreatment),i.features.xAxis.time?(i.features.xAxis.time.local&&(c.timeFixture=new Rickshaw.Fixtures.Time.Local),m=new Rickshaw.Graph.Axis.Time(c)):m=new Rickshaw.Graph.Axis.X(c),m.render()}if(i.features.yAxis){var d={graph:w};if(i.features.yAxis.tickFormat){var v=i.features.yAxis.tickFormat;d.tickFormat="string"==typeof v?Rickshaw.Fixtures.Number[v]:v}p||(p=new Rickshaw.Graph.Axis.Y(d),p.render())}if(i.features.legend){if(!h){h=e("<div></div>")(i),f.append(h);var x=new Rickshaw.Graph.Legend({graph:w,element:h[0]});if(i.features.legend.toggle){new Rickshaw.Graph.Behavior.Series.Toggle({graph:w,legend:x})}if(i.features.legend.highlight){new Rickshaw.Graph.Behavior.Series.Highlight({graph:w,legend:x})}}}else h&&(h.remove(),h=null);i.features.preview?l||(l=e("<div></div>")(i),f.append(l),new Rickshaw.Graph.RangeSlider.Preview({graph:w,element:l[0]})):l&&(l.remove(),l=null)}}var f,u,h,l,m,p,w,g,k=i.$watch("options",function(e,r){angular.equals(e,r)||c()},!0),d=i.$watchCollection("series",function(e,r){angular.equals(e,r)||o()},!0),v=i.$watch("features",function(e,r){angular.equals(e,r)||c()},!0);i.$on("$destroy",function(){k(),d(),v()}),angular.element(r).on("resize",function(){i.$broadcast("rickshaw::resize")}),i.$on("rickshaw::resize",function(){s()}),c()},controller:["$scope","$element","$attrs",function(e,r,i){}]}}]);